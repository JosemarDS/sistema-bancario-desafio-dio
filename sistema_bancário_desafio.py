# -*- coding: utf-8 -*-
"""Sistema Banc√°rio - Desafio

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1RRUqPCknxPM_oMn7bElSpo-HrslMJsEm
"""

# ============= SISTEMA BANC√ÅRIO V2 ============= #
# Autor: Josemar Joel Dami√£o Sebasti√£o
# Objetivo: C√≥digo modularizado com fun√ß√µes e suporte a m√∫ltiplos usu√°rios e contas.

# Constantes globais
LIMITE_SAQUES = 3 # Define o limite de saques di√°rios como 3
AGENCIA = "0001" # Define o n√∫mero da ag√™ncia como "0001"

# ---------------- FUN√á√ïES PRINCIPAIS ---------------- #

def depositar(saldo, valor, extrato, /): # Define a fun√ß√£o depositar com argumentos posicionais (saldo, valor, extrato)
    """
    Fun√ß√£o de dep√≥sito.

    Args:
        saldo (float): Saldo atual da conta.
        valor (float): Valor a ser depositado.
        extrato (str): Hist√≥rico de transa√ß√µes.

    Returns:
        tuple: Saldo atualizado e extrato atualizado.
    """
    if valor > 0: # Verifica se o valor do dep√≥sito √© positivo
        saldo += valor # Adiciona o valor ao saldo
        extrato += f"Dep√≥sito: R$ {valor:.2f}\n" # Adiciona a transa√ß√£o ao extrato
        print("\n‚úÖ Dep√≥sito realizado com sucesso!") # Imprime mensagem de sucesso
    else: # Caso o valor n√£o seja positivo
        print("\n‚ùå Opera√ß√£o falhou! O valor informado √© inv√°lido.") # Imprime mensagem de erro
    return saldo, extrato # Retorna o saldo e o extrato atualizados


def sacar(*, saldo, valor, extrato, limite, numero_saques, limite_saques): # Define a fun√ß√£o sacar com argumentos nomeados
    """
    Fun√ß√£o de saque.

    Args:
        saldo (float): Saldo atual da conta.
        valor (float): Valor a ser sacado.
        extrato (str): Hist√≥rico de transa√ß√µes.
        limite (float): Limite m√°ximo por saque.
        numero_saques (int): N√∫mero de saques realizados no dia.
        limite_saques (int): Limite m√°ximo de saques por dia.

    Returns:
        tuple: Saldo atualizado, extrato atualizado e n√∫mero de saques atualizado.
    """
    excedeu_saldo = valor > saldo # Verifica se o valor do saque excede o saldo dispon√≠vel
    excedeu_limite = valor > limite # Verifica se o valor do saque excede o limite por saque
    excedeu_saques = numero_saques >= limite_saques # Verifica se o n√∫mero de saques excede o limite di√°rio

    if excedeu_saldo: # Se excedeu o saldo
        print("\n‚ùå Opera√ß√£o falhou! Saldo insuficiente.") # Imprime mensagem de erro
    elif excedeu_limite: # Se excedeu o limite por saque
        print("\n‚ùå Opera√ß√£o falhou! Valor do saque excede o limite permitido.") # Imprime mensagem de erro
    elif excedeu_saques: # Se excedeu o limite di√°rio de saques
        print("\n‚ùå Opera√ß√£o falhou! N√∫mero m√°ximo de saques atingido.") # Imprime mensagem de erro
    elif valor > 0: # Se o valor do saque for positivo e n√£o exceder os limites
        saldo -= valor # Subtrai o valor do saldo
        extrato += f"Saque: R$ {valor:.2f}\n" # Adiciona a transa√ß√£o ao extrato
        numero_saques += 1 # Incrementa o contador de saques
        print("\n‚úÖ Saque realizado com sucesso!") # Imprime mensagem de sucesso
    else: # Caso o valor n√£o seja positivo
        print("\n‚ùå Opera√ß√£o falhou! Valor inv√°lido.") # Imprime mensagem de erro

    return saldo, extrato, numero_saques # Retorna o saldo, extrato e n√∫mero de saques atualizados


def exibir_extrato(saldo, /, *, extrato): # Define a fun√ß√£o exibir_extrato com argumento posicional (saldo) e nomeado (extrato)
    """
    Fun√ß√£o para exibir o extrato.

    Args:
        saldo (float): Saldo atual da conta (posicional).
        extrato (str): Hist√≥rico de transa√ß√µes (nomeado).
    """
    print("\n================ EXTRATO ================") # Imprime o cabe√ßalho do extrato
    print("N√£o foram realizadas movimenta√ß√µes." if not extrato else extrato) # Imprime mensagem se o extrato estiver vazio ou o conte√∫do do extrato
    print(f"\nSaldo atual: R$ {saldo:.2f}") # Imprime o saldo atual
    print("==========================================") # Imprime o rodap√© do extrato


# ---------------- FUN√á√ïES DE USU√ÅRIOS E CONTAS ---------------- #

def criar_usuario(usuarios): # Define a fun√ß√£o criar_usuario
    """
    Cria um novo usu√°rio.

    Args:
        usuarios (list): Lista de usu√°rios existentes.
    """
    cpf = input("Informe o CPF (somente n√∫meros): ") # Solicita o CPF do usu√°rio
    usuario = filtrar_usuario(cpf, usuarios) # Filtra a lista de usu√°rios para verificar se o CPF j√° existe

    if usuario: # Se o usu√°rio com o CPF j√° existir
        print("\n‚ö†Ô∏è J√° existe um usu√°rio com este CPF!") # Imprime mensagem de aviso
        return # Sai da fun√ß√£o

    nome = input("Informe o nome completo: ") # Solicita o nome completo do usu√°rio
    data_nascimento = input("Informe a data de nascimento (dd-mm-aaaa): ") # Solicita a data de nascimento do usu√°rio
    endereco = input("Informe o endere√ßo (logradouro, n¬∫ - bairro - cidade/UF): ") # Solicita o endere√ßo do usu√°rio

    usuarios.append({ # Adiciona o novo usu√°rio √† lista de usu√°rios
        "nome": nome,
        "data_nascimento": data_nascimento,
        "cpf": cpf,
        "endereco": endereco
    })
    print("\n‚úÖ Usu√°rio criado com sucesso!") # Imprime mensagem de sucesso


def filtrar_usuario(cpf, usuarios): # Define a fun√ß√£o filtrar_usuario
    """
    Retorna o usu√°rio com base no CPF.

    Args:
        cpf (str): CPF do usu√°rio a ser filtrado.
        usuarios (list): Lista de usu√°rios existentes.

    Returns:
        dict or None: O usu√°rio encontrado ou None se n√£o encontrado.
    """
    usuarios_filtrados = [usuario for usuario in usuarios if usuario["cpf"] == cpf] # Filtra a lista de usu√°rios pelo CPF
    return usuarios_filtrados[0] if usuarios_filtrados else None # Retorna o primeiro usu√°rio encontrado ou None


def criar_conta(agencia, numero_conta, usuarios): # Define a fun√ß√£o criar_conta
    """
    Cria uma nova conta corrente para um usu√°rio existente.

    Args:
        agencia (str): N√∫mero da ag√™ncia.
        numero_conta (int): Pr√≥ximo n√∫mero de conta dispon√≠vel.
        usuarios (list): Lista de usu√°rios existentes.

    Returns:
        dict or None: A nova conta criada ou None se o usu√°rio n√£o for encontrado.
    """
    cpf = input("Informe o CPF do titular: ") # Solicita o CPF do titular da conta
    usuario = filtrar_usuario(cpf, usuarios) # Filtra a lista de usu√°rios para encontrar o titular

    if usuario: # Se o usu√°rio titular for encontrado
        print("\n‚úÖ Conta criada com sucesso!") # Imprime mensagem de sucesso
        return { # Retorna os dados da nova conta
            "agencia": agencia,
            "numero_conta": numero_conta,
            "usuario": usuario
        }

    print("\n‚ùå Usu√°rio n√£o encontrado. Cria√ß√£o de conta encerrada.") # Imprime mensagem de erro se o usu√°rio n√£o for encontrado
    return None # Retorna None se o usu√°rio n√£o for encontrado


def listar_contas(contas): # Define a fun√ß√£o listar_contas
    """
    Lista todas as contas cadastradas.

    Args:
        contas (list): Lista de contas existentes.
    """
    print("\n============= CONTAS CADASTRADAS =============") # Imprime o cabe√ßalho da lista de contas
    for conta in contas: # Itera sobre a lista de contas
        linha = f"""
Ag√™ncia:\t{conta['agencia']}
C/C:\t\t{conta['numero_conta']}
Titular:\t{conta['usuario']['nome']}
""" # Formata as informa√ß√µes de cada conta
        print(linha) # Imprime as informa√ß√µes da conta
        print("=" * 40) # Imprime uma linha separadora


# ---------------- PROGRAMA PRINCIPAL ---------------- #

def main(): # Define a fun√ß√£o principal do programa
    """Fun√ß√£o principal do sistema banc√°rio."""
    saldo = 0 # Inicializa o saldo da conta
    limite = 500 # Inicializa o limite de saque por opera√ß√£o
    extrato = "" # Inicializa o extrato como uma string vazia
    numero_saques = 0 # Inicializa o contador de saques di√°rios
    usuarios = [] # Inicializa a lista de usu√°rios
    contas = [] # Inicializa a lista de contas
    numero_conta = 1 # Inicializa o n√∫mero da pr√≥xima conta a ser criada

    menu = """
================ MENU ================
[d] Depositar
[s] Sacar
[e] Extrato
[nu] Novo Usu√°rio
[nc] Nova Conta
[lc] Listar Contas
[q] Sair
=> """ # Define o menu de op√ß√µes do sistema

    while True: # Inicia um loop infinito para o menu
        opcao = input(menu).lower() # Solicita a op√ß√£o do usu√°rio e converte para min√∫scula

        if opcao == "d": # Se a op√ß√£o for 'd' (Depositar)
            valor = float(input("Informe o valor do dep√≥sito: ")) # Solicita o valor do dep√≥sito
            saldo, extrato = depositar(saldo, valor, extrato) # Chama a fun√ß√£o depositar

        elif opcao == "s": # Se a op√ß√£o for 's' (Sacar)
            valor = float(input("Informe o valor do saque: ")) # Solicita o valor do saque
            saldo, extrato, numero_saques = sacar( # Chama a fun√ß√£o sacar com argumentos nomeados
                saldo=saldo,
                valor=valor,
                extrato=extrato,
                limite=limite,
                numero_saques=numero_saques,
                limite_saques=LIMITE_SAQUES,
            )

        elif opcao == "e": # Se a op√ß√£o for 'e' (Extrato)
            exibir_extrato(saldo, extrato=extrato) # Chama a fun√ß√£o exibir_extrato

        elif opcao == "nu": # Se a op√ß√£o for 'nu' (Novo Usu√°rio)
            criar_usuario(usuarios) # Chama a fun√ß√£o criar_usuario

        elif opcao == "nc": # Se a op√ß√£o for 'nc' (Nova Conta)
            conta = criar_conta(AGENCIA, numero_conta, usuarios) # Chama a fun√ß√£o criar_conta
            if conta: # Se a conta for criada com sucesso
                contas.append(conta) # Adiciona a nova conta √† lista de contas
                numero_conta += 1 # Incrementa o n√∫mero da pr√≥xima conta

        elif opcao == "lc": # Se a op√ß√£o for 'lc' (Listar Contas)
            listar_contas(contas) # Chama a fun√ß√£o listar_contas

        elif opcao == "q": # Se a op√ß√£o for 'q' (Sair)
            print("\nüëã Encerrando o sistema banc√°rio. At√© logo!") # Imprime mensagem de despedida
            break # Sai do loop while

        else: # Se a op√ß√£o for inv√°lida
            print("\n‚ùå Op√ß√£o inv√°lida, tente novamente.") # Imprime mensagem de erro


# Execu√ß√£o do programa principal
if __name__ == "__main__": # Verifica se o script est√° sendo executado diretamente
    main() # Chama a fun√ß√£o principal